<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ title }}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/static/css/layout.css">
  <link rel="icon" type="image/x-icon" href="{{ url_for('static', path='images/favicon.ico') }}">
  {% block head_extras %}{% endblock %}
</head>
<body class="d-flex flex-column min-vh-100">
  <header class="navbar navbar-light bg-light py-3 px-2 justify-content-center position-relative">
    <div id="header-left" class="position-absolute d-flex align-items-center">
      <button id="menu-button" class="navbar-toggler p-0" type="button" data-bs-toggle="offcanvas" data-bs-target="#sideMenu" aria-controls="sideMenu">
        <span class="navbar-toggler-icon"></span>
      </button>
      {% if billing_account and show_billing_sync_button %}
      <button id="billing-sync-button" type="button"
        class="btn ms-3"
        style="--bs-btn-color: {{ billing_account.color }}; --bs-btn-border-color: {{ billing_account.color }}; --bs-btn-hover-color: {{ billing_account.color }}; --bs-btn-hover-border-color: {{ billing_account.color }}; --bs-btn-hover-bg: rgba(255,255,255,0.15); border-color: {{ billing_account.color }}; color: {{ billing_account.color }}; background-color: transparent;">
        <span id="billing-sync-button-label" class="billing-sync-button-label">Traer movimientos para: {{ billing_account.name }}</span>
        <span id="billing-notification-badge" class="notification-badge d-none" aria-hidden="true"></span>
      </button>
      {% endif %}
    </div>
    <h1 class="h3 m-0">{{ header_title|safe }}</h1>
    <a href="/" id="logo-link" class="position-absolute">
      <img src="/static/images/logo_sqr.png" alt="Logo">
    </a>
  </header>
  <div class="offcanvas offcanvas-start" tabindex="-1" id="sideMenu" aria-label="Side menu">
    <div class="offcanvas-header justify-content-end">
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
    </div>
    <div class="offcanvas-body d-flex flex-column">
      {% set billing_section_paths = ["/billing.html", "/certificados-retencion.html", "/billing-account-details.html"] %}
      {% set billing_section_active = request.url.path in billing_section_paths %}
      <ul class="list-unstyled">
        <li class="mb-2"><a href="/" class="text-decoration-none side-menu-link"><i class="bi bi-house me-2"></i>Movimientos</a></li>
        <li class="mb-2">
          <a class="text-decoration-none side-menu-link d-flex align-items-center justify-content-between" data-bs-toggle="collapse" href="#billing-submenu" role="button" aria-expanded="{{ 'true' if billing_section_active else 'false' }}" aria-controls="billing-submenu">
            <span><i class="bi bi-receipt me-2"></i>Facturación</span>
            <i class="bi bi-chevron-down ms-2 menu-chevron"></i>
          </a>
          <ul class="list-unstyled side-menu-submenu collapse{% if billing_section_active %} show{% endif %}" id="billing-submenu">
            <li class="mb-2 ms-4">
              <a href="/billing.html" class="text-decoration-none side-menu-link d-block{% if request.url.path == '/billing.html' %} fw-semibold{% endif %}">Facturas</a>
            </li>
            <li class="mb-2 ms-4">
              <a href="/certificados-retencion.html" class="text-decoration-none side-menu-link d-block{% if request.url.path == '/certificados-retencion.html' %} fw-semibold{% endif %}">Certificados de retención</a>
            </li>
          </ul>
        </li>
        <li class="mb-2"><a href="/accounts.html" class="text-decoration-none side-menu-link"><i class="bi bi-graph-up me-2"></i>Cuentas</a></li>
        {% if user %}
        <li class="mb-2"><a href="/users" class="text-decoration-none side-menu-link"><i class="bi bi-people me-2"></i>Usuarios</a></li>
        {% if user.is_admin %}
        <li class="mb-2"><a href="/config.html" class="text-decoration-none side-menu-link"><i class="bi bi-gear me-2"></i>Configuración</a></li>
        {% endif %}
        <li><a href="/logout" class="text-decoration-none side-menu-link"><i class="bi bi-box-arrow-right me-2"></i>Salir</a></li>
        {% else %}
        <li><a href="/login" class="text-decoration-none side-menu-link"><i class="bi bi-box-arrow-in-right me-2"></i>Ingresar</a></li>
        {% endif %}
      </ul>
      <img src="/static/images/logo_long.png" alt="TransArgentina logo" class="img-fluid mt-auto mx-auto">
    </div>
  </div>
  {% block content %}{% endblock %}
  <div class="modal fade" id="app-message-modal" tabindex="-1" aria-labelledby="app-message-modal-label" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="app-message-modal-label">Aviso</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body" id="app-message-modal-body"></div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary d-none" data-modal-secondary>Cancelar</button>
          <button type="button" class="btn btn-primary" data-modal-primary>Aceptar</button>
        </div>
      </div>
    </div>
  </div>
  <div id="overlay" class="d-none">
    <div class="spinner-border text-primary" role="status"></div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
  <script>
    window.isAdmin = {{ 1 if user and user.is_admin else 0 }};
  </script>
  <script src="/static/js/modal.js?v=1"></script>
  {% block scripts %}{% endblock %}
</body>
</html>
