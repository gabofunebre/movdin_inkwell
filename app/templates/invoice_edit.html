{% extends "base.html" %}

{% block content %}
<div class="container mt-4" style="max-width:500px;">
  <form id="inv-form" data-type="{{ invoice.type }}" data-invoice-id="{{ invoice.id }}">
    <div class="row g-3 mb-3">
      <div class="col-sm-6">
        <label class="form-label w-100">Fecha
          <input type="date" name="date" class="form-control" value="{{ invoice.date }}" required>
        </label>
      </div>
      <div class="col-sm-6">
        <label class="form-label w-100">Número
          <input type="text" name="number" class="form-control" value="{{ invoice.number }}" required>
        </label>
      </div>
    </div>
    <div class="mb-3">
      <label class="form-label w-100">Concepto
        <input type="text" name="description" class="form-control" value="{{ invoice.description }}" required>
      </label>
    </div>
    <div class="row g-3 justify-content-end mb-3">
      <div class="col-sm-6 ms-auto">
        <label class="form-label w-100">Total sin impuesto
          <input type="number" step="0.01" name="amount" class="form-control text-end" value="{{ invoice.amount }}" required>
        </label>
      </div>
    </div>
    <div class="mb-3">
      <div class="tax-line">
        <span class="form-label tax-label mb-0">IVA</span>
        <div class="tax-field">
          <span class="tax-symbol tax-symbol-percent">%</span>
          <input type="number" step="0.01" name="iva_percent" class="form-control tax-percent text-end" value="{{ invoice.iva_percent }}" aria-label="Porcentaje de IVA">
        </div>
        <div class="tax-field tax-field-amount">
          <span class="tax-symbol tax-symbol-currency">$</span>
          <input type="text" name="iva_amount" class="form-control tax-amount text-end" value="{{ invoice.iva_amount }}" aria-label="Monto de IVA">
        </div>
      </div>
    </div>
    <div id="ret-row" class="mb-3{% if invoice.type != 'purchase' %} d-none{% endif %}">
      <div class="tax-line">
        <span class="form-label tax-label mb-0">Retenciones y otros</span>
        <div class="tax-field tax-field-amount">
          <span class="tax-symbol tax-symbol-currency">$</span>
          <input type="text" name="retenciones" class="form-control tax-amount text-end" value="{{ invoice.retenciones }}" aria-label="Monto de retenciones y otros">
        </div>
      </div>
    </div>
    <div id="iibb-row" class="mb-3{% if invoice.type == 'purchase' %} d-none{% endif %}">
      <div class="tax-line">
        <span class="form-label tax-label mb-0">SIRCREB</span>
        <div class="tax-field">
          <span class="tax-symbol tax-symbol-percent">%</span>
          <input type="number" step="0.01" name="iibb_percent" class="form-control tax-percent text-end" value="{{ invoice.iibb_percent }}" aria-label="Porcentaje de SIRCREB">
        </div>
        <div class="tax-field tax-field-amount">
          <span class="tax-symbol tax-symbol-currency">$</span>
          <input type="text" name="iibb_amount" class="form-control tax-amount text-end" value="{{ invoice.iibb_amount }}" aria-label="Monto de SIRCREB">
        </div>
      </div>
    </div>
    <div class="mb-3">
      <span class="form-label d-block">Cuenta de facturación:</span>
      <span id="billing-account" class="fw-bold" style="color:{{ account.color if account else '' }}">{{ account.name if account else '' }}</span>
      <input type="hidden" name="account_id" value="{{ invoice.account_id }}">
    </div>
    <div id="inv-alert" class="alert d-none" role="alert"></div>
    <div class="d-flex justify-content-between">
      <button type="submit" class="btn btn-primary">Guardar</button>
      <a href="/invoice/{{ invoice.id }}" class="btn btn-secondary">Cancelar</a>
    </div>
  </form>
</div>
{% endblock %}

{% block scripts %}
<script id="invoice-data" type="application/json">{{ invoice|tojson }}</script>
{% if account %}
<script id="account-data" type="application/json">{{ account|tojson }}</script>
{% endif %}
<script type="module" src="/static/js/invoice_edit.js?v=1"></script>
{% endblock %}
